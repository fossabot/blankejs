<!DOCTYPE html>
<html>
	<head>
        <script src="pixi.min.js"></script>
        <script src="SAT.min.js"></script>
        <script src="blanke.js"></script>
    </head>
    <body>
        <div id="game"></div>
    </body>
    <script type="text/javascript">
        window.onload = () => {
            let { Asset, Draw, Entity, Game, Hitbox, Input, Map, Scene, Sprite, Util, View } = Blanke("#game", {autofocus: true});
            Asset.add('sprite-example.png',{name:'luigi_walk',offset:[9,54],speed:0.2,frame_size:[27,49],frames:3,columns:3});
            
            Input.set("move_left","left","a");
            Input.set("move_right","right","d");
            Input.set("move_up","up","w");
            Input.set("move_down","down","s");
            Input.move_up.can_repeat = false;
            
            class Mario extends Entity {
                init () {
                    this.addSprite('luigi_walk');
                    this.addShape('main',{type:'rect', shape:[0,0,this.sprite_width,this.sprite_height]});
                    
                    this.sprite_pivot.set(this.sprite_width/2,this.sprite_height/2)
                    this.gravity = 0.2;
                    this.gravity_direction = 90;
                }
                update (dt) {
                    this.hspeed = 0;
                    if (Input("move_right").pressed) 
                        this.hspeed = 2;
                    if (Input("move_left").pressed) 
                        this.hspeed = -2;
                    if (Input("move_up").pressed)
                        this.vspeed = -5;

                    this.onCollide['main'] = (other, res) => {
                        if (other.tag == 'ground')
                            this.collisionStop();
                    }
                }
            }    

            Scene("scene1",{
                onStart: (scene) => {
                    let drawing = new Draw(
                        ['fill',Draw.white],
                        ['rect',-800,-800,1600,1600],
                        ['lineStyle', 2, Draw.white],
                        ['fill', Draw.green, 1],
                        ['star', Game.width/2, Game.height/2, 5, 50],
                        ['fill']
                    );
                    let mario = new Mario();
                                    
                    let vw_main = View("main");
                    vw_main.follow(mario);
                    vw_main.scale.set(1.5);

                    let map_level1 = new Map("level1");
                    map_level1.debug = true;
                    map_level1.addHitbox({tag:'ground', type:'rect', shape:[0,80,40,40]})
                    map_level1.addHitbox({tag:'ground', type:'rect', shape:[180,0,20,Game.height]});
                    map_level1.addHitbox({tag:'ground', type:'rect', shape:[0,180,Game.width,20]});
                    
                    vw_main.add(scene, map_level1);
                },
                onUpdate: (scene, dt) => {
                    let vw_main = View("main");
                    //vw_main.angle += 0.2 * dt;
                }
            });
            Scene.start("scene1");
        }
    </script>
</html>